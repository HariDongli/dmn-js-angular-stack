!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.SelectionRanges={})}(this,function(t){"use strict";var e=function(t,e){return t^e};var n=/\b(Array|Date|Object|Math|JSON)\b/g,r=function(t,e){var r=function(t){for(var e=[],n=0;n<t.length;n++)~e.indexOf(t[n])||e.push(t[n]);return e}(function(t){return t.replace(/\.\w+|\w+ *\(|"[^"]*"|'[^']*'|\/([^/]+)\//g,"").replace(n,"").match(/[a-zA-Z_]\w*/g)||[]}(t));return e&&"string"==typeof e&&(e=function(t){return function(e){return t+e}}(e)),e?function(t,e,n){return t.replace(/\.\w+|\w+ *\(|"[^"]*"|'[^']*'|\/([^/]+)\/|[a-zA-Z_]\w*/g,function(t){return"("==t[t.length-1]?n(t):~e.indexOf(t)?n(t):t})}(t,r,e):r};var i=o;function o(t,e){if(!(this instanceof o))return new o(t,e);if(this.node=this.start=this.peeked=t,this.root=e,this.closingTag=!1,this._revisit=!0,this._selects=[],this._rejects=[],t&&this.higher(t))throw new Error("root must be a parent or ancestor to node")}function s(t,n){var r="nextSibling"==t;return function(i,o,s){i=this.compile(i),o=o&&o>0?o:1;for(var u=this.node,a=this.closingTag,f=this._revisit;u;){if(e(r,a)&&u[n])u=u[n],a=!r;else if(1==u.nodeType&&!u[n]&&e(r,a)){if(a=r,!f)continue}else if(u[t])u=u[t],a=!r;else if(u=u.parentNode,a=r,!f)continue;if(!u||this.higher(u,this.root))break;if(i(u)&&this.selects(u,s)&&this.rejects(u,s)){if(--o)continue;return s||(this.node=u),this.closingTag=a,u}}return null}}o.prototype.reset=function(t){return this.node=t||this.start,this},o.prototype.revisit=function(t){return this._revisit=void 0==t||t,this},o.prototype.opening=function(){return 1==this.node.nodeType&&(this.closingTag=!1),this},o.prototype.atOpening=function(){return!this.closingTag},o.prototype.closing=function(){return 1==this.node.nodeType&&(this.closingTag=!0),this},o.prototype.atClosing=function(){return this.closingTag},o.prototype.next=s("nextSibling","firstChild"),o.prototype.previous=o.prototype.prev=s("previousSibling","lastChild"),o.prototype.select=function(t){return t=this.compile(t),this._selects.push(t),this},o.prototype.selects=function(t,e){var n=this._selects,r=n.length;if(!r)return!0;for(var i=0;i<r;i++)if(n[i].call(this,t,e))return!0;return!1},o.prototype.reject=function(t){return t=this.compile(t),this._rejects.push(t),this},o.prototype.rejects=function(t,e){var n=this._rejects,r=n.length;if(!r)return!0;for(var i=0;i<r;i++)if(n[i].call(this,t,e))return!1;return!0},o.prototype.higher=function(t){var e=this.root;if(!e)return!1;for(t=t.parentNode;t&&t!=e;)t=t.parentNode;return t!=e},o.prototype.compile=function(t){switch(typeof t){case"number":return function(e){return t==e.nodeType};case"string":return new Function("node","return "+r(t,"node."));case"function":return t;default:return function(){return!0}}},o.prototype.peak=o.prototype.peek=function(t,e){return 1==arguments.length&&(e=t,t=!0),(e=void 0==e?1:e)?e>0?this.next(t,e,!0):this.prev(t,Math.abs(e),!0):this.node},o.prototype.use=function(t){return t(this),this};var u=window.getSelection();function a(t){u.removeAllRanges(),u.addRange(t)}function f(t){if(!u.rangeCount)return null;var e=u.focusNode;return c(e)&&(e=e.parentNode),t==e||t.contains(e)}function c(t){return 3===t.nodeType}function h(t){return 1===t.nodeType&&"BR"===t.nodeName}function p(t){return 1===t.nodeType&&"DIV"===t.nodeName}function l(t){return 1===t.nodeType&&"P"===t.nodeName}t.applyRange=a,t.getWindowSelection=function(){return u},t.isSelected=f,t.setRange=function(t,e){a(function(t,e){for(var n,r=e.start,o=e.end,s=document.createRange(),u=i(t.firstChild,t),a=u.node,f=!1,d=0;a;){if(d===r&&(f?s.setStartAfter(a):s.setStartBefore(a)),d===o)return f?s.setEndAfter(a):s.setEndBefore(a),s;if(f||(h(a)||a.previousSibling&&(p(a)||l(a)))&&d++,c(a)){if(n=a.textContent.length,d<=r&&d+n>r&&s.setStart(a,r-d),d+n>o)return s.setEnd(a,o-d),s;d+=n}a=u.next(),f=u.closingTag}return d<=r&&(t.lastChild?s.setStartAfter(t.lastChild):s.setStart(t,0)),t.lastChild?s.setEndAfter(t.lastChild):s.setEnd(t,0),s}(t,e))},t.getRange=function(t){if(!f(t))return null;var e,n,r=u.getRangeAt(0),o=r.startContainer,s=r.endContainer,a=r.startOffset,d=r.endOffset,g=i(t.firstChild,t),y=g.node,v=!1,b=0;function S(t,e){return 1===arguments.length&&(e=t),t.parentNode===s&&e==s.childNodes[d]}function T(t,e){return 1===arguments.length&&(e=t),t.parentNode===o&&e==o.childNodes[a]}for(;y&&(T(y)&&(n=b),!S(y));){if(v||(h(y)||e&&e.nextSibling==y&&(p(y)||l(y)))&&b++,c(y)){if(o===y&&(n=b+a),s===y){b+=d;break}b+=y.textContent.length}if((c(y)||v)&&(T(y,y.nextSibling)&&(n=b),S(y,y.nextSibling)))break;e=y,y=g.next(),v=g.closingTag}return{start:void 0===n?b:n,end:b}},t.annotateRange=function(t,e){return e.start===e.end?t.substring(0,e.start)+"|"+t.substring(e.start):t.substring(0,e.start)+"<"+t.substring(e.start,e.end)+">"+t.substring(e.end)},Object.defineProperty(t,"__esModule",{value:!0})});
